!function(xhr,wx){
    window.weixin = function (o) {
        // encodeURIComponent 作用：处理二次转发时生产签名失效
        xhr.open("GET", "/finance/wx/token?url=" + encodeURIComponent(location.href), true);
        xhr.send(null);
        xhr.onload = function () {
            var token = JSON.parse(xhr.responseText);
            wx.config({
                debug: o.debug,      // 弹窗调试
                appId: token.appId, // 微信 appId
                timestamp: token.timestamp,   // 时间戳
                nonceStr: token.nonceStr,    // 随机字符
                signature: token.signature, // 签名
                jsApiList: [
                    "onMenuShareTimeline",
                    "onMenuShareAppMessage",
                    "onMenuShareQQ",
                    "onMenuShareQZone"
                ]
            });
            wx.ready(function () {
                var param = {
                    title   : o.title, // 分享标题
                    desc    : o.desc, // 分享描述
                    link    : token.url, // 分享地址
                    imgUrl  : o.imgUrl, // 分享显示的缩略图地址
                    success : o.success || function(){
                        // 分享成功可以做相应的数据处理
                    }
                }
                wx.onMenuShareTimeline(param);
                wx.onMenuShareAppMessage(param);
                wx.onMenuShareQQ(param);
                wx.onMenuShareQZone(param);
            });
        }
    }
}(new XMLHttpRequest,function(e){function n(n,i,o){e.WeixinJSBridge?WeixinJSBridge.invoke(n,t(i),function(e){r(n,e,o)}):s(n,o)}function i(n,i,t){e.WeixinJSBridge?WeixinJSBridge.on(n,function(e){t&&t.trigger&&t.trigger(e),r(n,e,i)}):t?s(n,t):s(n,i)}function t(e){return e=e||{},e.appId=L.appId,e.verifyAppId=L.appId,e.verifySignType="sha1",e.verifyTimestamp=L.timestamp+"",e.verifyNonceStr=L.nonceStr,e.verifySignature=L.signature,e}function o(e){return{timeStamp:e.timestamp+"",nonceStr:e.nonceStr,"package":e.package,paySign:e.paySign,signType:e.signType||"SHA1"}}function r(e,n,i){var t,o,r;switch(delete n.err_code,delete n.err_desc,delete n.err_detail,t=n.errMsg,t||(t=n.err_msg,delete n.err_msg,t=c(e,t),n.errMsg=t),i=i||{},i._complete&&(i._complete(n),delete i._complete),t=n.errMsg||"",L.debug&&!i.isInnerInvoke&&alert(JSON.stringify(n)),o=t.indexOf(":"),r=t.substring(o+1)){case"ok":i.success&&i.success(n);break;case"cancel":i.cancel&&i.cancel(n);break;default:i.fail&&i.fail(n)}i.complete&&i.complete(n)}function c(e,n){var i,t,o=e,r=m[o];return r&&(o=r),i="ok",n&&(t=n.indexOf(":"),i=n.substring(t+1),"confirm"==i&&(i="ok"),"failed"==i&&(i="fail"),-1!=i.indexOf("failed_")&&(i=i.substring(7)),-1!=i.indexOf("fail_")&&(i=i.substring(5)),i=i.replace(/_/g," "),i=i.toLowerCase(),("access denied"==i||"no permission to execute"==i)&&(i="permission denied"),"config"==o&&"function not exist"==i&&(i="ok"),""==i&&(i="fail")),n=o+":"+i}function a(e){var n,i,t,o;if(e){for(n=0,i=e.length;i>n;++n)t=e[n],o=f[t],o&&(e[n]=o);return e}}function s(e,n){if(!(!L.debug||n&&n.isInnerInvoke)){var i=m[e];i&&(e=i),n&&n._complete&&delete n._complete,console.log('"'+e+'",',n||"")}}function d(){0!=b.preVerifyState&&(_||w||L.debug||"6.0.2">k||b.systemType<0||M||(M=!0,b.appId=L.appId,b.initTime=x.initEndTime-x.initStartTime,b.preVerifyTime=x.preVerifyEndTime-x.preVerifyStartTime,A.getNetworkType({isInnerInvoke:!0,success:function(e){var n,i;b.networkType=e.networkType,n="http://open.weixin.qq.com/sdk/report?v="+b.version+"&o="+b.preVerifyState+"&s="+b.systemType+"&c="+b.clientVersion+"&a="+b.appId+"&n="+b.networkType+"&i="+b.initTime+"&p="+b.preVerifyTime+"&u="+b.url,i=new Image,i.src=n}})))}function u(){return(new Date).getTime()}function l(n){I&&(e.WeixinJSBridge?n():g.addEventListener&&g.addEventListener("WeixinJSBridgeReady",n,!1))}function p(){A.invoke||(A.invoke=function(n,i,o){e.WeixinJSBridge&&WeixinJSBridge.invoke(n,t(i),o)},A.on=function(n,i){e.WeixinJSBridge&&WeixinJSBridge.on(n,i)})}var f,m,g,h,y,S,_,w,I,T,v,k,M,V,x,b,L,P,W,A;if(!e.jWeixin)return f={config:"preVerifyJSAPI",onMenuShareTimeline:"menu:share:timeline",onMenuShareAppMessage:"menu:share:appmessage",onMenuShareQQ:"menu:share:qq",onMenuShareWeibo:"menu:share:weiboApp",onMenuShareQZone:"menu:share:QZone",previewImage:"imagePreview",getLocation:"geoLocation",openProductSpecificView:"openProductViewWithPid",addCard:"batchAddCard",openCard:"batchViewCard",chooseWXPay:"getBrandWCPayRequest"},m=function(){var e,n={};for(e in f)n[f[e]]=e;return n}(),g=e.document,h=g.title,y=navigator.userAgent.toLowerCase(),S=navigator.platform.toLowerCase(),_=!(!S.match("mac")&&!S.match("win")),w=-1!=y.indexOf("wxdebugger"),I=-1!=y.indexOf("micromessenger"),T=-1!=y.indexOf("android"),v=-1!=y.indexOf("iphone")||-1!=y.indexOf("ipad"),k=function(){var e=y.match(/micromessenger\/(\d+\.\d+\.\d+)/)||y.match(/micromessenger\/(\d+\.\d+)/);return e?e[1]:""}(),M=!1,V=!1,x={initStartTime:u(),initEndTime:0,preVerifyStartTime:0,preVerifyEndTime:0},b={version:1,appId:"",initTime:0,preVerifyTime:0,networkType:"",preVerifyState:1,systemType:v?1:T?2:-1,clientVersion:k,url:encodeURIComponent(location.href)},L={},P={_completes:[]},W={state:0,data:{}},l(function(){x.initEndTime=u()}),A={config:function(e){L=e,s("config",e);var i=L.check===!1?!1:!0;l(function(){var e,t,o;if(i)n(f.config,{verifyJsApiList:a(L.jsApiList)},function(){P._complete=function(e){x.preVerifyEndTime=u(),W.state=1,W.data=e},P.success=function(){b.preVerifyState=0},P.fail=function(e){P._fail?P._fail(e):W.state=-1};var e=P._completes;return e.push(function(){d()}),P.complete=function(){for(var n=0,i=e.length;i>n;++n)e[n]();P._completes=[]},P}()),x.preVerifyStartTime=u();else{for(W.state=1,e=P._completes,t=0,o=e.length;o>t;++t)e[t]();P._completes=[]}}),L.beta&&p()},ready:function(e){0!=W.state?e():(P._completes.push(e),!I&&L.debug&&e())},error:function(e){"6.0.2">k||V||(V=!0,-1==W.state?e(W.data):P._fail=e)},checkJsApi:function(e){var i=function(e){var n,i,t=e.checkResult;for(n in t)i=m[n],i&&(t[i]=t[n],delete t[n]);return e};n("checkJsApi",{jsApiList:a(e.jsApiList)},function(){return e._complete=function(e){if(T){var n=e.checkResult;n&&(e.checkResult=JSON.parse(n))}e=i(e)},e}())},onMenuShareTimeline:function(e){i(f.onMenuShareTimeline,{complete:function(){n("shareTimeline",{title:e.title||h,desc:e.title||h,img_url:e.imgUrl||"",link:e.link||location.href,type:e.type||"link",data_url:e.dataUrl||""},e)}},e)},onMenuShareAppMessage:function(e){i(f.onMenuShareAppMessage,{complete:function(){n("sendAppMessage",{title:e.title||h,desc:e.desc||"",link:e.link||location.href,img_url:e.imgUrl||"",type:e.type||"link",data_url:e.dataUrl||""},e)}},e)},onMenuShareQQ:function(e){i(f.onMenuShareQQ,{complete:function(){n("shareQQ",{title:e.title||h,desc:e.desc||"",img_url:e.imgUrl||"",link:e.link||location.href},e)}},e)},onMenuShareWeibo:function(e){i(f.onMenuShareWeibo,{complete:function(){n("shareWeiboApp",{title:e.title||h,desc:e.desc||"",img_url:e.imgUrl||"",link:e.link||location.href},e)}},e)},onMenuShareQZone:function(e){i(f.onMenuShareQZone,{complete:function(){n("shareQZone",{title:e.title||h,desc:e.desc||"",img_url:e.imgUrl||"",link:e.link||location.href},e)}},e)},startRecord:function(e){n("startRecord",{},e)},stopRecord:function(e){n("stopRecord",{},e)},onVoiceRecordEnd:function(e){i("onVoiceRecordEnd",e)},playVoice:function(e){n("playVoice",{localId:e.localId},e)},pauseVoice:function(e){n("pauseVoice",{localId:e.localId},e)},stopVoice:function(e){n("stopVoice",{localId:e.localId},e)},onVoicePlayEnd:function(e){i("onVoicePlayEnd",e)},uploadVoice:function(e){n("uploadVoice",{localId:e.localId,isShowProgressTips:0==e.isShowProgressTips?0:1},e)},downloadVoice:function(e){n("downloadVoice",{serverId:e.serverId,isShowProgressTips:0==e.isShowProgressTips?0:1},e)},translateVoice:function(e){n("translateVoice",{localId:e.localId,isShowProgressTips:0==e.isShowProgressTips?0:1},e)},chooseImage:function(e){n("chooseImage",{scene:"1|2",count:e.count||9,sizeType:e.sizeType||["original","compressed"],sourceType:e.sourceType||["album","camera"]},function(){return e._complete=function(e){if(T){var n=e.localIds;n&&(e.localIds=JSON.parse(n))}},e}())},previewImage:function(e){n(f.previewImage,{current:e.current,urls:e.urls},e)},uploadImage:function(e){n("uploadImage",{localId:e.localId,isShowProgressTips:0==e.isShowProgressTips?0:1},e)},downloadImage:function(e){n("downloadImage",{serverId:e.serverId,isShowProgressTips:0==e.isShowProgressTips?0:1},e)},getNetworkType:function(e){var i=function(e){var n,i,t,o=e.errMsg;if(e.errMsg="getNetworkType:ok",n=e.subtype,delete e.subtype,n)e.networkType=n;else switch(i=o.indexOf(":"),t=o.substring(i+1)){case"wifi":case"edge":case"wwan":e.networkType=t;break;default:e.errMsg="getNetworkType:fail"}return e};n("getNetworkType",{},function(){return e._complete=function(e){e=i(e)},e}())},openLocation:function(e){n("openLocation",{latitude:e.latitude,longitude:e.longitude,name:e.name||"",address:e.address||"",scale:e.scale||28,infoUrl:e.infoUrl||""},e)},getLocation:function(e){e=e||{},n(f.getLocation,{type:e.type||"wgs84"},function(){return e._complete=function(e){delete e.type},e}())},hideOptionMenu:function(e){n("hideOptionMenu",{},e)},showOptionMenu:function(e){n("showOptionMenu",{},e)},closeWindow:function(e){e=e||{},n("closeWindow",{},e)},hideMenuItems:function(e){n("hideMenuItems",{menuList:e.menuList},e)},showMenuItems:function(e){n("showMenuItems",{menuList:e.menuList},e)},hideAllNonBaseMenuItem:function(e){n("hideAllNonBaseMenuItem",{},e)},showAllNonBaseMenuItem:function(e){n("showAllNonBaseMenuItem",{},e)},scanQRCode:function(e){e=e||{},n("scanQRCode",{needResult:e.needResult||0,scanType:e.scanType||["qrCode","barCode"]},function(){return e._complete=function(e){var n,i;v&&(n=e.resultStr,n&&(i=JSON.parse(n),e.resultStr=i&&i.scan_code&&i.scan_code.scan_result))},e}())},openProductSpecificView:function(e){n(f.openProductSpecificView,{pid:e.productId,view_type:e.viewType||0,ext_info:e.extInfo},e)},addCard:function(e){var i,t,o,r,c=e.cardList,a=[];for(i=0,t=c.length;t>i;++i)o=c[i],r={card_id:o.cardId,card_ext:o.cardExt},a.push(r);n(f.addCard,{card_list:a},function(){return e._complete=function(e){var n,i,t,o=e.card_list;if(o){for(o=JSON.parse(o),n=0,i=o.length;i>n;++n)t=o[n],t.cardId=t.card_id,t.cardExt=t.card_ext,t.isSuccess=t.is_succ?!0:!1,delete t.card_id,delete t.card_ext,delete t.is_succ;e.cardList=o,delete e.card_list}},e}())},chooseCard:function(e){n("chooseCard",{app_id:L.appId,location_id:e.shopId||"",sign_type:e.signType||"SHA1",card_id:e.cardId||"",card_type:e.cardType||"",card_sign:e.cardSign,time_stamp:e.timestamp+"",nonce_str:e.nonceStr},function(){return e._complete=function(e){e.cardList=e.choose_card_info,delete e.choose_card_info},e}())},openCard:function(e){var i,t,o,r,c=e.cardList,a=[];for(i=0,t=c.length;t>i;++i)o=c[i],r={card_id:o.cardId,code:o.code},a.push(r);n(f.openCard,{card_list:a},e)},chooseWXPay:function(e){n(f.chooseWXPay,o(e),e)}},e.wx=e.jWeixin=A,A}(window));