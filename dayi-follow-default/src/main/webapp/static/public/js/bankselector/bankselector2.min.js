var bankselector={};bankselector.list=[{id:"1",name:"工商银行",site:"http://www.icbc.com.cn/icbc/"},{id:"2",name:"农业银行",site:"http://www.abchina.com/cn/"},{id:"3",name:"中国银行",site:"http://www.boc.cn/"},{id:"4",name:"建设银行",site:"http://www.ccb.com/cn/home/indexv3.html"},{id:"8",name:"交通银行",site:"http://www.bankcomm.com/BankCommSite/default.shtml"},{id:"9",name:"邮储银行",site:"http://www.psbc.com/cn/index.html"},{id:"10",name:"中信银行",site:"http://bank.ecitic.com/"},{id:"11",name:"光大银行",site:"http://www.cebbank.com/"},{id:"12",name:"华夏银行",site:"http://www.hxb.com.cn/home/cn/"},{id:"13",name:"民生银行",site:"http://www.cmbc.com.cn/"},{id:"14",name:"广发银行",site:"http://www.cgbchina.com.cn/"},{id:"15",name:"平安银行",site:"http://one.pingan.com/"},{id:"16",name:"招商银行",site:"http://www.cmbchina.com/"},{id:"17",name:"兴业银行",site:"http://www.cib.com.cn/cn/index.html"},{id:"18",name:"浦东发展银行",site:"http://www.spdb.com.cn/"},{id:"19",name:"东莞银行",site:"http://www.dongguanbank.cn/Site/Home/CN"},{id:"26",name:"东莞农村商业银行",site:"http://www.drcbank.com/"}];bankselector.getBankInfo=function(a){var n=bankselector.list;var e=n.length;for(var t=0;t<e;t++){if(a==n[t].id){return n[t]}}return null};bankselector.box=function(a,n){var e=null,t=null;$.ajax({url:"/api/bank/get/bank/all.json",dataType:"json",async:false,success:function(a){e=a}});$.ajax({url:"/api/bank/get/province/all.json",dataType:"json",async:false,success:function(a){t=a}});if(e==null||t==null){layer.alert('<p style="text-align:center;">数据获取出错</p>',"温馨提示");return}var i='<form class="bank_select" onsubmit="return false">'+'<input type="hidden" name="bankId" value="'+n+'">'+'<input type="hidden" name="bankCodeId" value="">'+'<table class="form_table box_noborder">'+"</tr>"+"<tr>"+'<td id="selectCity">'+'<select name="prov" class="inptStyle">'+'<option value="">请选择省</option>'+"</select>"+'<select name="areaId" class="inptStyle" style="margin-left:10px;">'+'<option value="">请选择市</option>'+"</select>"+"</td>"+"</tr>"+"<tr>"+"<td>"+'<input type="text" name="bankName" class="inptStyle" placeholder="输入支行关键字" style="margin-right:10px;" />'+'<button type="button" class="btn_style1" data-act="seacher">查询</button>'+'<p class="gray fz12">输入支行关键字查询，并在查询结果列表中选择支行</p>'+"</td>"+"</tr>"+"</table>"+"</form>"+'<div data-rel="branchList" class="branchList"></div>';var l=function(a){var n=null;$.ajax({url:"/api/bank/get/area/all.json",dataType:"json",data:{province:a},async:false,success:function(a){n=a}});if(n==null){layer.alert('<p style="text-align:center;">数据获取出错</p>',"温馨提示")}return n};layer.open({type:1,title:"银行卡支行信息",area:["444px","500px"],content:i,btn:["提交"],yes:function(n,e){var t=e.find("[name=bankCodeId]").val();if(t===""){layer.msg('<p style="text-align:center;">你还没选择支行</p>',"温馨提示")}else{a(t)}},success:function(a,n){var e=0;var i=a.find('[name="prov"]');var c=a.find('[name="areaId"]');var r=a.find('[name="bankId"]');var o=a.find('[name="bankName"]');var s=a.find('[data-act="seacher"]');var d=a.find('[data-rel="branchList"]');var p="";var m=bankselector.list;var v=m.length;for(var u=0;u<v;u++){if(!!bankselector.finance&&m[u].id==26){continue}p+='<option value="'+m[u].id+'">'+m[u].name+"</option>"}r.append(p);var f="";var b=t.items;var h=b.length;for(var u=0;u<h;u++){f+='<option value="'+b[u].province+'">'+b[u].province+"</option>"}i.append(f);var w=function(a,n,e){if(a.val()==""){e.val("");layer.tips(n,a);a.focus();return false}return true};r.on("change",function(){if(c.val()!=""){c.change()}});i.on("change",function(){var a='<option value="">请选择市</option>';var n=$(this).val();if(n==""){c.html(a);return}var e=l(n);if(e==null){return}var t=e.items;var i=t.length;var a='<option value="">请选择市</option>';for(var r=0;r<i;r++){a+='<option value="'+t[r].id+'">'+t[r].city+"</option>"}c.html(a)});c.on("change",function(){if(c.val()!=""){e=1;s.click()}});o.on("keydown",function(){w(c,"请先选择城市",$(this))});o.keyup(function(a){if(a.keyCode===13){s.click()}});r.on("change",function(){if($(this).val()==""){o.val("")}});s.on("click",function(){if(e==0&&o.val()==""&&c.val()==""){layer.tips("输入支行关键字",o);return false}var n=a.find("form");$.ajax({url:"/api/bank/get/bankCode/all.json",dataType:"json",data:n.serialize(),async:false,success:function(a){if(a.fail){layer.alert('<p style="text-align:center;color:red;">'+a.msg+"</p>","温馨提示")}var e=r.val();var t=r.find(":selected").text();var l=a.items;var o=l.length;var s=i.find(":selected").html();var p=c.find(":selected").html();var m='<ul style="padding:0 20px;overflow: auto;height:200px;">';for(var v=0;v<o;v++){m+='<li><label><input type="radio" name="branch" value="'+l[v].number+'" data-name="'+l[v].name+'" data-bankid="'+e+'" data-bank="'+t+'"  data-prov="'+s+'" data-city="'+p+'" data-id="'+l[v].id+'"/> '+l[v].name+"</label></li>"}m+="</ul>";d.html(m);d.find('[name="branch"]').on("click",function(){n.find("[name=bankCodeId]").val($(this).data("id"))})}});e=0})}})};