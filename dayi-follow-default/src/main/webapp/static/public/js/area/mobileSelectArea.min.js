(function(t,e){if(typeof define==="function"&&define.amd){define(["jquery","dialog"],e)}else if(typeof define==="function"&&define.cmd){define(function(require,exports,module){var t=require("jquery");var i=require("dialog");return e(t,i)})}else if(typeof exports==="object"){module.exports=e()}else{t.MobileSelectArea=e(jQuery||Zepto)}})(this,function(t,e){var i=function(){var t=Math.random().toString().replace(".","");this.id="scroller_"+t;this.scroller;this.data;this.index=0;this.value=[0,0,0];this.oldvalue;this.oldtext=[];this.text=["","",""];this.level=3;this.mtop=30;this.separator=" "};i.prototype={init:function(e){this.settings=t.extend({eventName:"click"},e);this.trigger=t(this.settings.trigger);this.settings.default==undefined?this.default=1:this.default=0;level=parseInt(this.settings.level);this.level=level>0?level:3;this.trigger.attr("readonly","readonly");this.value=this.settings.value&&this.settings.value.split(",")||[0,0,0];this.text=this.settings.text||this.trigger.val().split(" ")||["","",""];this.oldvalue=this.value.concat([]);this.oldtext=this.text.concat([]);this.clientHeight=document.documentElement.clientHeight||document.body.clientHeight;this.clientWidth=document.documentElement.clientWidth||document.body.clientWidth;this.bindEvent()},getData:function(){var e=this;var i=t.Deferred();if(typeof this.settings.data=="object"){this.data=this.settings.data;i.resolve()}else{t.ajax({dataType:"json",cache:true,url:this.settings.data,type:"GET",success:function(t){e.data=t.data;i.resolve()},accepts:{json:"application/json, text/javascript, */*; q=0.01"}})}return i},show:function(){var e=this;var i="";for(var s=0;s<e.level;s++){i+="<div></div>"}var a,n;if(e.settings.position=="bottom"){a={position:"bottom",width:"100%",className:"ui-dialog-bottom",animate:false};var n=[{no:"取消"},{yes:"确定"}]}t.confirm('<div class="ui-scroller-mask"><div id="'+e.id+'" class="ui-scroller">'+i+"<p></p></div></div>",n,function(t,i){if(t=="yes"){e.submit()}if(t=="no"){e.cancel()}this.dispose()},t.extend({width:320,height:215},a));e.scroller=t("#"+e.id);e.getData().done(function(){e.format()});var r=0,l=0;e.scroller.children().bind("touchstart",function(t){r=(t.changedTouches||t.originalEvent.changedTouches)[0].pageY});e.scroller.children().bind("touchmove",function(e){l=(e.changedTouches||e.originalEvent.changedTouches)[0].pageY;var i=l-r;var s=t(e.target).parent();if(s[0].nodeName!="DL"){return}var a=parseInt(s.css("top")||0)+i;s.css("top",a);r=l;return false});e.scroller.children().bind("touchend",function(i){l=(i.changedTouches||i.originalEvent.changedTouches)[0].pageY;var s=l-r;var a=t(i.target).parent();if(a[0].nodeName!="DL"){return}var n=t(a.parent()).index();var d=parseInt(a.css("top")||0)+s;if(d>e.mtop){d=e.mtop}if(d<-t(a).height()+60){d=-t(a).height()+60}var o=d/e.mtop;var h=Math.round(o);var c=Math.abs(h)+1;if(h==1){c=0}e.value[n]=t(a.children().get(c)).attr("ref");e.value[n]==0?e.text[n]="":e.text[n]=t(a.children().get(c)).html();if(!t(a.children().get(c)).hasClass("focus")){for(var u=e.level-1;u>n;u--){e.value[u]=0;e.text[u]=""}e.format()}t(a.children().get(c)).addClass("focus").siblings().removeClass("focus");a.css("top",h*e.mtop);return false})},bindEvent:function(){var t=this;this.trigger[t.settings.eventName](function(e){t.show();return false})},format:function(){var t=this;var e=t.scroller.children();this.f(this.data)},f:function(e){var i=this;var s=e;if(!s){s=[]}var a='<dl><dd ref="0">——</dd>';var n=0,r,l=i.mtop;if(i.index!==0&&i.value[i.index-1]=="0"&&this.default==0){a='<dl><dd ref="0" class="focus">——</dd>';i.value[i.index]=0;i.text[i.index]="";n=0}else{if(i.value[i.index]=="0"){a='<dl><dd ref="0" class="focus">——</dd>';n=0}if(s.length>0&&this.default==1){a="<dl>";var d=s[0].pid||0;var o=s[0].id||0;n=s[0].id;r=s[0].child;if(!i.value[this.index]){i.value[this.index]=o;i.text[this.index]=s[0].name}a+='<dd pid="'+d+'" class="'+u+'" ref="'+o+'">'+s[0].name+"</dd>"}for(var h=i.default,c=s.length;h<c;h++){var d=s[h].pid||0;var o=s[h].id||0;var u="";if(i.value[i.index]==o){u="focus";n=o;r=s[h].child;l=i.mtop*-(h-i.default)}a+='<dd pid="'+d+'" class="'+u+'" ref="'+o+'">'+s[h].name+"</dd>"}}a+="</dl>";var v=t(a);v.css("top",l);var f=i.scroller.children();t(f[i.index]).html(v);i.index++;if(i.index>i.level-1){i.index=0;return}i.f(r)},submit:function(){this.oldvalue=this.value.concat([]);this.oldtext=this.text.concat([]);if(this.trigger[0].nodeType==1){this.trigger.val(this.text.join(this.separator));this.trigger.attr("data-value",this.value.join(","))}this.trigger.next(":hidden").val(this.value.join(","));this.settings.callback&&this.settings.callback.call(this,this.scroller,this.text,this.value)},cancel:function(){this.value=this.oldvalue.concat([]);this.text=this.oldtext.concat([])}};return i});